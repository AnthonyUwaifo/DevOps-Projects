<!DOCTYPE html>
<html>
<head>
    <title>Tic Tac Toe Web</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            color: #333;
            text-align: center;
        }
        table {
            margin: 20px auto;
            border-spacing: 0;
        }
        td {
            width: 80px;
            height: 80px;
            text-align: center;
            vertical-align: middle;
            font-size: 32px;
            font-weight: bold;
            border: 2px solid #555;
            cursor: pointer;
            background-color: #fff;
            transition: background-color 0.2s;
        }
        td:hover {
            background-color: #e0e0e0;
        }
        #msg {
            font-size: 20px;
            margin-top: 15px;
            color: #006600;
        }
        #controls {
            margin-top: 10px;
        }
        button {
            font-size: 16px;
            padding: 8px 20px;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #0056b3;
        }
        select {
            padding: 5px 10px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <h2>Tic Tac Toe - Web Version</h2>
    <div>
        <label for="difficulty">Difficulty:</label>
        <select id="difficulty">
            <option value="easy">Easy</option>
            <option value="medium" selected>Medium</option>
            <option value="hard">Hard</option>
        </select>
    </div>
    <table id="board"></table>
    <div id="msg"></div>
    <div id="controls">
        <button onclick="resetGame()">Play Again</button>
    </div>
    <script>
        const boardEl = document.getElementById("board");
        const msgEl = document.getElementById("msg");
        const difficultyEl = document.getElementById("difficulty");
        let board, playerTurn;

        function initGame() {
            board = [["", "", ""], ["", "", ""], ["", "", ""]];
            playerTurn = true;
            msgEl.textContent = "";
            drawBoard();
        }

        function drawBoard() {
            boardEl.innerHTML = "";
            for (let r = 0; r < 3; r++) {
                const row = document.createElement("tr");
                for (let c = 0; c < 3; c++) {
                    const cell = document.createElement("td");
                    cell.textContent = board[r][c];
                    cell.addEventListener("click", () => handleMove(r, c));
                    row.appendChild(cell);
                }
                boardEl.appendChild(row);
            }
        }

        function handleMove(r, c) {
            if (!playerTurn || board[r][c]) return;
            board[r][c] = "X";
            playerTurn = false;
            drawBoard();
            if (checkGameEnd()) return;
            setTimeout(() => {
                fetch("/move", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ board, difficulty: difficultyEl.value })
            })
            .then(res => res.json())
            .then(data => {
                if (!board[data.row][data.col]) {
                    board[data.row][data.col] = "O";
                }
                drawBoard();
                checkGameEnd();
                    playerTurn = true;
                });
            }, 1500);
        }

        function checkGameEnd() {
            const winCombos = [
                [[0,0],[0,1],[0,2]], [[1,0],[1,1],[1,2]], [[2,0],[2,1],[2,2]],
                [[0,0],[1,0],[2,0]], [[0,1],[1,1],[2,1]], [[0,2],[1,2],[2,2]],
                [[0,0],[1,1],[2,2]], [[0,2],[1,1],[2,0]]
            ];
            for (let combo of winCombos) {
                const [a, b, c] = combo;
                if (board[a[0]][a[1]] &&
                    board[a[0]][a[1]] === board[b[0]][b[1]] &&
                    board[a[0]][a[1]] === board[c[0]][c[1]]) {
                    msgEl.textContent = `${board[a[0]][a[1]]} wins!`;
                    playerTurn = false;
                    return true;
                }
            }
            if (board.flat().every(cell => cell)) {
                msgEl.textContent = "It's a draw!";
                playerTurn = false;
                return true;
            }
            return false;
        }

        function resetGame() {
            initGame();
        }

        initGame();
    </script>
</body>
</html>